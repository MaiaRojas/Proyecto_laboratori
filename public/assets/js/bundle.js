"use strict";function harold(e){return e<10&&(e="0"+e),e}function initMap(e){var a;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){a={lat:t.coords.latitude,lng:t.coords.longitude},console.log(a);var s=Math.sqrt(Math.pow(a.lat,2)+Math.pow(a.lng,2)),n={lat:-12.0507126,lng:-77.045422},r=Math.sqrt(Math.pow(n.lat,2)+Math.pow(n.lng,2));1e3*Math.abs(r-s)>=2.429195?(console.log("Aun no estas en laboratoria"),$("#msjError").text("Aún no estas en Laboratoria , vuelve a registrarte cuando llegues"),setTimeout(function(){state.page=null,e()},3e3)):(console.log("Estas cerca de tu ubicacion"),"Tarde"!=state.user.Estado&&(state.user.Hora=checkP,state.user.Dia=fechaP,Postregister()),state.user.Hora=checkP,state.user.Dia=fechaP,e())}):($("#msjError").text("Tu navegador no soporta la geolocalización"),setTimeout(function(){state.page=null,e()},3e3))}var render=function(e){e.empty();var a=$('<div class="cont_App"></div>');a.append(header(function(a){return render(e)})),null==state.page?a.append(welcome(function(a){return render(e)})):1==state.page?a.append(reloj(function(a){return render(e)})):2==state.page?a.append(asistOk(function(a){return render(e)})):3==state.page?a.append(Tardanza(function(a){return render(e)})):4==state.page?a.append(Home(function(a){return render(e)})):5==state.page?a.append(Falta(function(a){return render(e)})):6==state.page?a.append(justificacion(function(a){return render(e)})):7==state.page?a.append(mensaje(function(a){return render(e)})):8==state.page&&a.append(AlePantalla(function(a){return render(e)})),e.append(a)},update=function(){render(root)},state={data:null,user:null,dia:new Date};$(function(e){getJSON("https://sheetsu.com/apis/v1.0/2049baff4052",function(e,a){if(e)return alert(e.message);console.log(a),state.data=a;var t=$(".root");render(t)})});var header=function(e){return $('<header><div class="container"><div class="row"><div class="col s12 center-align"><img src="assets/img/logo.svg" width=220px alt="logo"></div></div></div></header>')},welcome=function(e){var a=$('<section class="container center-align cont_welcome"></section>'),t=$('<h4 class="center" >Bienvenido a la App de Asistencia <br>Ingresa a tu cuenta </h4>');a.append(t);var s=$('<div class="container"></div>');a.append(s);var n=$('<div  class="row login" id="new_user"></div>');s.append(n);var r=$('<div class="col s10 push-s1"></div>');n.append(r);var i=$('<div class="left-align"></div>'),o=$('<label class="text_label" for="user_code">Usuario</label>'),l=$('<input class="in_lab" autofocus="autofocus" placeholder="Código Laboratoria" type="text"  id="user_code">');r.append(i),i.append(o),i.append(l);var d=$('<div class="left-align"></div>'),c=$('<label class="text_label" for="user_password">Contraseña</label>'),p=$('<input class="in_lab" autofocus="autofocus" placeholder="Contraseña" type="password"  id="user_password">');r.append(d),d.append(c),d.append(p);var u=$("<div></div>"),v=$('<p id="msjErrorR"></p>'),g=$('<a href="#" class="active">Olvide mi contraseña</a>');u.append(v,g),r.append(u);var f=$('<div class="form-actions"></div>'),h=$('<button id="btnEnviar" class="btn primary disabled btn-amarillo-lab">Ingresar</button>');r.append(f),f.append(h);var m=[];l.on("keyup",function(e){""!=l.val()?(h.removeClass("disabled"),Verificar(p.val())):h.addClass("disabled")}),p.on("keyup",function(e){""!=p.val()?h.removeClass("disabled"):h.addClass("disabled")});return h.on("click",function(a){a.preventDefault(),m=filterByEmail(state.data,l.val()),state.user=m[m.length-1];var t=Reingreso();if(console.log(Reingreso()),console.log(state.user),"Alejandra"==l.val()&&"1234"==p.val())state.page=8,e();else if(0!=m.length){var s=state.user.Codigo;p.val()==s?state.user.Dia!=t?ValidHora(e):v.text("Usted ya está registrada el día de Hoy"):v.text("Contraseña Incorreta")}else v.text("Usuario no existe")}),a},reloj=function(e){var a=$('<section class="container cont_timer"></section>'),t=$('<div class="welcome"></div>'),s=$("<p>Bienvenida <strong>"+state.user.Coder+"</strong></p>");t.append(s),a.append(t);var n=$('<div class="cont_clock"></div>'),r=$('<div class="day"></div>'),i=$('<h1 class="clock"></h1>'),o=$('<button type="button"  class="verde" id="btn_present" name="button" class="verde">Presente</button>'),l=$('<p id="msjError"></p>');n.append(r),n.append(i),n.append(o,l),a.append(n);var d=$('<div class="enlace"></div>'),c=$('<a href="#" class="active">Registrar ausencia</a>');d.append(c),n.append(d);var p,u,v=setInterval(function(){var e=new Date,a=e.getHours(),t=e.getMinutes(),s=e.getSeconds(),n=e.getDate(),r=e.getMonth()+1,i=e.getFullYear();p=harold(a)+":"+harold(t)+":"+harold(s),u=harold(n)+"/"+harold(r)+"/"+i,$(".day").text(harold(n)+"/"+harold(r)+"/"+i),$(".clock").text(harold(a)+":"+harold(t)+":"+harold(s))},1e3);return o.on("click",function(a){a.preventDefault(),clearInterval(v),ValidPuntualidad(e)}),c.on("click",function(a){a.preventDefault(),console.log(u),void 0!=u&&void 0!=p&&(clearInterval(v),state.user.Estado="Ausente",state.user.Hora=p,state.page=5,e())}),a},asistOk=function(e){console.log(state.time);var a=$('<section class="container center-align"></section>'),t=$('<div class="row"></div>'),s=$('<div class="title_asis"></div>'),n=$('<p class="negrita">'+state.user.Coder+"</p><p> Tu asistencia fue registrada a las :</p>"),r=$("<p>"+state.time+"</p>");s.append(n),s.append(r),t.append(s);var i=$('<div class="cont_asist col s6 push-s3"></div>'),o=$('<div class="radio-check"></div>'),l=$('<i class="large material-icons">check</i>');t.append(i),o.append(l),i.append(o);var d=$('<div class="cont_btn col s10 push-s1"></div>'),c=$('<button type="button"  id="btn_present" name="button" class="primary">IR AL HOME</button>'),p=$('<div class="enlace"></div>'),u=$('<a href="#" class="active">Ver asistencias</a>');return d.append(c),p.append(u),d.append(p),t.append(d),c.on("click",function(a){a.preventDefault(),state.page=4,e()}),a.append(t),a},Tardanza=function(e){var a=$('<div class="container"></div>'),t=$('<div class="row "></div>'),s=$('<h4 class="center-align">'+state.user.Coder+"</h4><p>, ¿Cuál es el motivo de tu tardanza?</p>"),n=$('<div class="col s12 left-align"></div>'),r=$("<p></p>"),i=$("<p></p>"),o=$("<p></p>"),l=$('<input type="radio" id="tardanza-1" value="Tráfico" class="with-gap" name="tardanza-justificacion" required checked>'),d=$('<input type="radio" id="tardanza-2" value="Me quede dormida" class="with-gap" name="tardanza-justificacion">'),c=$('<input type="radio" id="tardanza-3" value="Otros" class="with-gap" name="tardanza-justificacion">'),p=$('<label for="tardanza-1">Tráfico</label>'),u=$('<label for="tardanza-2">Me quedé dormida</label>'),v=$('<label for="tardanza-3">Ninguna de las anteriores</label>'),g=$('<a class="museo-sanse add-message spacing">Agregar mensaje</a>'),f=$('<div class="input-field col s12"></div>'),h=$('<textarea id="message" class="materialize-textarea"></textarea>'),m=$('<a class="waves-effect waves-light btn col s12 montserrat">Enviar</a>');return r.append(l,p),i.append(d,u),o.append(c,v),n.append(r,i,o,g,f,m),t.append(s,n),a.append(t),g.on("click",function(e){g.css("display","none"),f.append(h)}),m.on("click",function(a){state.page=7,state.user.Motivo=$("input[name=tardanza-justificacion]:checked").val()+":"+h.val(),Postregister(),e()}),a},Falta=function(e){var a=$('<div class="container"></div>'),t=$('<div class="row center-align"></div>'),s=$('<h5 class="negrita">'+state.user.Coder+" </h5><p>Cuéntale a Ale por qué no vendrás</p>"),n=$('<div class="col s12"></div>'),r=$('<div class="input-field col s12"></div>'),i=$('<textarea id="message" class="materialize-textarea"></textarea>'),o=$('<a class="waves-effect waves-light btn col s12 montserrat">Enviar</a>');return r.append(i),n.append(r,o),t.append(s,n),a.append(t),o.on("click",function(a){state.user.Dia=PedirHora(),state.user.Motivo=i.val(),state.page=4,Postregister(),e()}),a},Home=function(e){function a(e){return e<10&&(e="0"+e),e}for(var t=$('<div class="container"></div>'),s=$('<div class="row"></div>'),n=$('<div class="col s12"></div>'),r=$('<div class="col s12 bg-white"></div>'),i=$('<div class="col s12"></div>'),o=$("<p>Buen día "+state.user.Coder+"</p>"),l=$('<a href="#" class="active">Salir</a>'),d=$('<p class="title text-center">Agenda</p>'),c=$('<div class="date-home text-center"></div>'),p=["Registrarte","Trabajo","Coffee time","Almuerzo","Coffee time","Salida"],u=["00:01","09:30","10:20","13:00","15:10","18:00"],v=$('<ul class="diary"></ul>'),g=0;g<u.length;g++){var f=$('<li><span class="schedule-home">'+u[g]+"</span> | "+p[g]+"</li>");v.append(f)}var h=new Date,m=h.getDate(),b=h.getMonth()+1,w=h.getFullYear();return c.text("("+a(m)+"/"+a(b)+"/"+a(w)+")"),r.append(d,c,i),n.append(o,l),i.append(v),s.append(n,r),t.append(s),l.on("click",function(a){a.preventDefault(),state.page=null,e()}),t},justificacion=function(e){var a=$('<div class="container cont_just"></div>'),t=$('<div class="row"></div>'),s=$('<div class="col s12 center-align"></div>'),n=$("<h4>"+state.user.Coder+"</h4>"),r=$("<p>Aún no has registrado tu asistencia.<br>Por favor cuéntanos  por qué.</p>"),i=$('<textarea id="message" class="materialize-textarea"></textarea>'),o=$('<a class="btn col s12 montserrat">Enviar</a>');return s.append(n,r,i,o),t.append(s),a.append(t),o.on("click",function(a){a.preventDefault(),console.log("mensaje enviado"),state.user.Motivo=i.val(),state.user.Estado="Ausente",state.page=7,Postregister(),e()}),a},mensaje=function(e){var a=$('<section class="container center-align cont_msj"></section>'),t=$('<div class="row"></div>'),s=$('<div class="title_asis"></div>'),n=$('<p class="negrita">'+state.user.Coder+"</p><p> Tu mensaje ha sido enviado correctamente</p>");s.append(n),t.append(s);var r=$('<div class="cont_asist col s6 push-s3"></div>'),i=$('<div class="radio-check"></div>'),o=$('<i class="large material-icons">email</i>');t.append(r),i.append(o),r.append(i);var l=$('<div class="cont_btn col s10 push-s1"></div>'),d=$('<button type="button"  id="btn_present" name="button" class="primary">IR AL HOME</button>');return l.append(d),t.append(l),d.on("click",function(a){a.preventDefault(),state.page=4,e()}),a.append(t),a},AlePantalla=function(e){var a=0,t=0,s=0,n=$('<section class="container center-align"></section>'),r=$('<div class="row"></div>'),i=$('<div class="title_asis left-align"><p>Buen día Alejandra</p><p> Revisa la Asistencia de Hoy : '+harold(state.dia.getDate())+"/"+harold(state.dia.getMonth()+1)+"/"+harold(state.dia.getFullYear())+"</p> </div>"),o=$('<div class="flex_center"><h4>Registro Total</h4></div>'),l=$('<div class="sizedetail"><p class="Puntual">Puntual</p><p></p></div>'),d=$("<p></p>"),c=$('<div class="sizedetail"><p class="Tarde">Tarde</p><p></p></div>'),p=$("<p></p>"),u=$('<div class="sizedetail"><p class="Ausente">Ausente</p><p></p></div>'),v=$("<p></p>");o.append(l,c,u),l.append(d),c.append(p),u.append(v);var g=$('<div id="coders"></div>');n.append(r,i,o,g);var f=[],h=[];return $.get("https://sheetsu.com/apis/v1.0/2049baff4052",function(e){console.log(e),state.asistencia=e,$.each(state.asistencia,function(e,a){a.Dia===harold(state.dia.getDate())+"/"+harold(state.dia.getMonth()+1)+"/"+harold(state.dia.getFullYear())&&f.push(a)}),$.each(f,function(e,a){-1===$.inArray(a.Squad,h)&&h.push(a.Squad)});var n=0,r=0,i=0;$.each(h,function(e,o){var l=$('<ul class="collapsible" data-collapsible="expandable" id ='+o+"></ul>"),d=$("<li></li>"),c=$('<div class="collapsible-header"></div>'),p=$('<div class="collapsible-body"></div>'),u=$('<div class="title_squad"><h4 class="left-align">'+o+"</h4></div>"),v=$('<div class="flex_center"></div>');u.append(v),f.forEach(function(e){if(o==e.Squad){switch(e.Estado){case"Ausente":n++,a++;break;case"Puntual":r++,t++;break;case"Tarde":i++,s++}detalle(e,p)}}),g.append(l),l.prepend(d),d.append(c,p),c.append(u),v.append('<div class="sizedetail"><p class="Ausente">Ausente </p><p>'+n+"</p></div>"),v.append('<div class="sizedetail"><p class="Puntual">Puntual </p><p> '+r+"</p></div>"),v.append('<div class="sizedetail"><p class="Tarde">Tarde </p><p> '+i+"</p></div>"),n=0,r=0,i=0,$(document).ready(function(){console.log("hola"),$(".collapsible").collapsible()})}),console.log(t),console.log(a),d.text(t),v.text(a),p.text(s)}),n},detalle=function(e,a){var t=$('<div class="detail_coder"></div>'),s=$('<img src="assets/img/'+e.Tipo+'.svg"  class="img-responsive" alt="foto">'),n=$("<p>"+e.Coder+"</p>"),r=$('<span class="'+e.Estado+'">'+e.Estado+"</span>");a.append(t),t.append(s,n,r)},filterByEmail=function(e,a){var t=e.filter(function(e){return e.Email.toLowerCase()==a.toLowerCase()});return console.log(t),t},getJSON=function(e,a){var t=new XMLHttpRequest;t.addEventListener("load",function(){if(200!==t.status)return a(new Error("Error loading JSON from "+e+"("+t.status+")"));a(null,t.response)}),t.open("GET",e),t.responseType="json",t.send()},Postregister=function(e){$.post("https://sheetsu.com/apis/v1.0/2049baff4052",{Coder:state.user.Coder,Email:state.user.Email,Codigo:state.user.Codigo,Squad:state.user.Squad,Tipo:state.user.Tipo,Dia:state.user.Dia,Hora:state.user.Hora,Estado:state.user.Estado,Motivo:state.user.Motivo,Sede:state.user.Sede},function(e){console.log("Enviando Data")})},Verificar=function(e){""!=e?$("#btnEnviar").removeClass("disabled"):$("#btnEnviar").addClass("disabled")},VerificarUbi=function(e){initMap(e)},ValidHora=function(e){var a=new Date,t=a.getHours(),s=a.getMinutes(),n=a.getSeconds(),r=a.getDate(),i=a.getMonth()+1,o=a.getFullYear(),l=harold(t)+":"+harold(s)+":"+harold(n),d=harold(r)+"/"+harold(i)+"/"+o;parseInt("0000".slice(0,2))<=t&&t<=parseInt("1200".slice(0,2))?t==parseInt("1200".slice(0,2))&&s>parseInt("1200".slice(2,4))?(console.log("Ingresa fuera de hora"),state.user.Dia=d,state.user.Hora=l,state.user.Motivo="",state.page=6,e()):(console.log("Ingresa normal"),state.page=1,e()):(console.log("Ingresa fuera de hora"),state.user.Dia=d,console.log(l),state.user.Hora=l,state.page=6,e())},UbicacionX,checkP,fechaP,ValidPuntualidad=function(e){var a=new Date,t=a.getHours(),s=a.getMinutes(),n=a.getSeconds(),r=a.getDate(),i=a.getMonth()+1,o=a.getFullYear();checkP=harold(t)+":"+harold(s)+":"+harold(n),fechaP=harold(r)+"/"+harold(i)+"/"+o,state.time=checkP,parseInt("0000".slice(0,2))<=t&&t<=parseInt("1030".slice(0,2))?t==parseInt("1030".slice(0,2))&&s>parseInt("1030".slice(2,4))?(state.user.Estado="Tarde",state.page=3,VerificarUbi(e)):(state.user.Estado="Puntual",state.user.Motivo="",state.page=2,VerificarUbi(e)):(state.user.Estado="Tarde",state.page=3,VerificarUbi(e))},Reingreso=function(){var e=new Date,a=e.getDate(),t=e.getMonth()+1,s=e.getFullYear();return harold(a)+"/"+harold(t)+"/"+s},PedirHora=function(){var e=new Date,a=e.getDate(),t=e.getMonth()+1,s=e.getFullYear();return harold(a)+"/"+harold(t)+"/"+s};